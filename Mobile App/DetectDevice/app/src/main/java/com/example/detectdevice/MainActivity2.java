package com.example.detectdevice;

import android.content.Intent;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.content.pm.ResolveInfo;
import android.graphics.Color;
import android.icu.text.AlphabeticIndex;
import android.net.Uri;
import android.os.Build;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ListView;
import android.widget.TextView;

import androidx.appcompat.app.AppCompatActivity;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;


public class MainActivity2 extends AppCompatActivity {

    private ListView mListView, pListView;
    private TextView textView2, textView3;
    private Button mButton;
    private List<String> mComponentList;
    private ArrayAdapter<String> mAdapter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main2);


        // assign value
        //btn_viewProduct = findViewById(R.id.btn_viewProduct);
        //list_packages = findViewById(R.id.list_packages);
        mListView = findViewById(R.id.list_packages);
        mButton = findViewById(R.id.btn_viewProduct);

        textView2 = findViewById(R.id.textView2);
        textView2.setTextColor(Color.RED);
        textView3 = findViewById(R.id.textView3);





        mComponentList = new ArrayList<>();
        mAdapter = new ArrayAdapter<>(this, android.R.layout.simple_list_item_1, mComponentList);
        mListView.setAdapter(mAdapter);


        // print messages by clicking item of listView1


        Map<String, Double> map = new HashMap<>();
        map.put("Android 10", 7.7);
        map.put("Android 11", 4.2);
        map.put("Android 12", 3.9);

        pListView = findViewById(R.id.cvss_score);

// Set up the ListView and onItemClick listener
        mListView.setOnItemClickListener((parent, view, position, id) -> {
            String selectedKey = parent.getItemAtPosition(position).toString();
            Double selectedValue = map.get(selectedKey);

            if (selectedValue != null) {
                textView2.setText("Your OS version Risk score is "+ selectedValue.toString());
                textView3.setText("Alternative Suggestions");

                // Filter the map entries based on the selected value
                List<Map.Entry<String, Double>> filteredEntries = null;
                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {
                    filteredEntries = map.entrySet().stream()
                            .filter(entry -> !entry.getKey().equals(selectedKey) && entry.getValue() < selectedValue)
                            .collect(Collectors.toList());
                }

                // Set the filtered entries as the adapter of pListView
                pListView.setAdapter(new ArrayAdapter<>(this, android.R.layout.simple_list_item_1, filteredEntries));
                //pListView.setTextColor(Color.GREEN);

            } else {
                textView2.setText("Selected item not found in map.");
            }
        });









// click button to display install products
        mButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                try {
                    identifyComponents();
                } catch (PackageManager.NameNotFoundException e) {
                    e.printStackTrace();
                }
            }
        });
    }

    private void identifyComponents() throws PackageManager.NameNotFoundException {

        PackageManager pm = getPackageManager();

        // Get list of installed packages
        List<PackageInfo> packages = pm.getInstalledPackages(PackageManager.GET_META_DATA);


        // Get operating system version
        String osVersion = Build.VERSION.RELEASE;
        mComponentList.add("Android " + osVersion);

        // Check default web browser
        Intent browserIntent = new Intent(Intent.ACTION_VIEW, Uri.parse("http://www.google.com"));
        ResolveInfo resolveInfo = pm.resolveActivity(browserIntent, PackageManager.MATCH_DEFAULT_ONLY);
        String defaultBrowser = resolveInfo.activityInfo.packageName;
        // get verision
        PackageInfo packageInfo = pm.getPackageInfo(defaultBrowser, PackageManager.GET_META_DATA);
        String version = packageInfo.versionName;
        mComponentList.add("Web Browser: " + defaultBrowser + " (v" + version + ")");

        // Notify adapter of changes
        mAdapter.notifyDataSetChanged();
    }



}








